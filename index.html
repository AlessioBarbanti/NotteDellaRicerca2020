<html>
<meta charset="UTF-16">

<head>
    <title> NotteDellaRicerca2020 </title>




    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <link rel="stylesheet" href="index.css" />

    </head>

<body>

    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <div id="3Ddiv"></div>
            </div>
            <div class="modal-body">
              <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Impedit voluptate maiores molestias obcaecati nisi? Repudiandae sapiente at laborum obcaecati, accusantium possimus quae aliquid voluptatibus temporibus delectus esse, culpa odio maiores.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
            </div>
          </div>
          
        </div>
      </div>

    <div id="panorama">
        <div id="controls">
            <button id="ciao" type="button" class="btn btn-lg btn-danger ctrl" data-toggle="popover" title="Inventario"
                data-placement="top" data-content="Fino ad ora hai raccolto 0/23 SDGs">Inventario</button>
        </div>
    </div>






      <script>
//***************************************************************PANNELLUM*************************************************************//
        viewer = pannellum.viewer('panorama', {
            //"hotSpotDebug": true,
            "autoLoad": true,
            "default": {
                "firstScene": "EsternoCampus",
                "sceneFadeDuration": 1000
            },

            "scenes": {
                "EsternoCampus": {
                    "title": "Esterno Campus",
                    "hfov": 110,
                    "pitch": 4.099,
                    "yaw": 107.33,
                    "type": "equirectangular",
                    "panorama": "img/rooms/EsternoCampus.jpg",
                    "hotSpots": [
                        {
                            "pitch": -1.23,
                            "yaw": 150,
                            "type": "scene",
                            "text": "IngressoCampus",
                            "sceneId": "IngressoCampus"
                        }
                    ]
                },

                "IngressoCampus": {
                    "title": "IngressoCampus",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/IngressoCampus.jpg",
                    "hotSpots": [
                        {
                            "pitch": -0.6,
                            "yaw": 37.1,
                            "type": "scene",
                            "text": "AulaMagna123",
                            "sceneId": "AulaMagna",
                            "targetYaw": -23,
                            "targetPitch": 2
                        },
                        {
                            "pitch": -14.50,
                            "yaw": -147.95,
                            "cssClass": "prova1",
                            "id": "prova1",
                            "clickHandlerFunc": showModal, //onclick function
                            "clickHandlerArgs": "1",
                            //"createTooltipFunc": hotspot,
                            //"createTooltipArgs": "-- posso passare valori ad una funzione -- "
                        },
                        {
                            "pitch": -14.50,
                            "yaw": -200.95,
                            "cssClass": "prova1",
                            "id": "2",
                            "clickHandlerFunc": showModal, //onclick function
                            "clickHandlerArgs": "2",
                            //"createTooltipFunc": hotspot,
                            //"createTooltipArgs": "-- posso passare valori ad una funzione -- "
                        }
                    ]
                },

                "AulaMagna": {
                    "title": "Aula Magna",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/AulaMagna.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "EsternoCampus123",
                            "sceneId": "EsternoCampus",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa Ã¨ una bella lavagna"
                        }
                    ]
                }

            }
        });

        $(document).ready(function () {
            $('[data-toggle="popover"]').popover();
        });









        //Gestione punti
        var numeroRitrovamenti = 0;

        function showModal(i){
            $("#myModal").modal();
            addPoint(i);
        }



        function addPoint(args, i) {

            numeroRitrovamenti++;
            document.getElementById("ciao").setAttribute('data-content', "Attualmente hai trovato " + numeroRitrovamenti + "/23 SDGs!");

            alert("Hai trovato il SDG numero" + i + "!");
            viewer.removeHotSpot(i);



            if (numeroRitrovamenti == 2) {
                alert("Hai trovato tutti gli SDG!")
            }

        }




    </script>




<script src="js/three.js"></script>
		<script type="module">
            //****************************************************************THREE.JS*************************************************************
      let model;
      let wave;

import { GLTFLoader } from './node_modules/three/examples/jsm/loaders/GLTFLoader.js';
import { OrbitControls } from './node_modules/three/examples/jsm/controls/OrbitControls.js';


var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 500);
const loader = new GLTFLoader();
var mixer;
let fileAnimations;
let clock = new THREE.Clock();
var renderer = new THREE.WebGLRenderer({ alpha: true });

renderer.setSize(200,200);

//////////////////////////////////////////////////////////////NOT WORKING, NEED TO FIX IT ////////////////////////////////////////////

console.log(document.getElementsByClassName("prova1"));
var list = document.getElementsByClassName("prova1");
console.log(list);
list.getElementsByClassName("prova1").appendChild(renderer.domElement);

loader.load( '3Dimg/2_goal.glb', function ( gltf ) {
  model = gltf.scene;
  model.rotation.x += 0.5;
  fileAnimations = gltf.animations;
  mixer = new THREE.AnimationMixer(model);
  mixer.clipAction(fileAnimations[0]).play();
  mixer.clipAction(fileAnimations[1]).play();
  mixer.clipAction(fileAnimations[2]).play();
scene.add( gltf.scene );

}, undefined, function ( error ) {

console.error(error);

} );


camera.position.z = 5;
const hemiLight = new THREE.HemisphereLight( 0xffffff, 0x444444, 1.1 );
hemiLight.position.set( 10, 20, 10 );
scene.add( hemiLight );

const dirLight = new THREE.DirectionalLight( 0xffffff, 0.8 );
dirLight.position.set( - 3, 10, - 10 );
scene.add( dirLight );
const controls = new OrbitControls( camera, renderer.domElement );





//controls.update() must be called after any manual changes to the camera's transform
controls.update();

function animate() {

    requestAnimationFrame( animate );
    if (mixer) {
      model.rotation.y += 0.01;
    mixer.update(clock.getDelta());
  }

	controls.update();
	renderer.render( scene, camera );

}





animate();








  </script>

</body>

</html>
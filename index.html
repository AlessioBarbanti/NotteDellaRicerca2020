<html>
<meta charset="UTF-16">

<head>
    <title> NotteDellaRicerca2020 </title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <link rel="stylesheet" href="index.css" />
    <!-- TODO OBBLIGARE IL LANDSCAPE-->
</head>

<body>

    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <div id="3Ddiv"></div>
                </div>
                <div class="modal-body">
                    <p>Ingresso in Aula Magna sbloccato!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
                </div>
            </div>

        </div>
    </div>

    <div id="panorama">
        <div id="controls">
            <button id="ciao" type="button" class="btn btn-lg btn-danger ctrl" data-toggle="popover" title="Inventario"
                data-placement="top" data-content="Fino ad ora hai raccolto 0/23 SDGs">Inventario</button>
        </div>
    </div>



    <script src="js/three.js"></script>


    <script type="module">



        //***************************************************************PANNELLUM*************************************************************//
        var viewer = pannellum.viewer('panorama', {
            "hotSpotDebug": true,
            "autoLoad": true,
            "default": {
                "firstScene": "Aula2",
                "sceneFadeDuration": 2000
            },

            "scenes": { 


                "EsternoCampus": {
                    "title": "EsternoCampus",
                    "pitch": 9,
                    "yaw": 45,

                    // "minYaw": -90, //metà di haov
                    // "maxYaw": 90,
                    // "minPitch": 0,
                    // "maxPitch": 0,

                    // "haov": 180,
                    // "vaov": 68,

                    // "hfov": 40,
                    // "vfov": 500,
                    // "minHfov": 50,
                    // "maxHfov": 100,

                    "type": "equirectangular",
                    "panorama": "img/rooms/EsternoCampus.jpg",
                    "hotSpots": [
                        {
                            "pitch": -1.23,
                            "yaw": 150,
                            "type": "scene",
                            "text": "IngressoCampus",
                            "sceneId": "IngressoCampus"
                        }
                    ],
                    
                },




                "IngressoCampus": {
                    "title": "IngressoCampus",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/IngressoCampus.jpg",
                    "hotSpots": [

                        {
                            "pitch": -14.50,
                            "yaw": -147.95,
                            "cssClass": "prova1",
                            "id": "1",
                            "clickHandlerFunc": showModal, //onclick function
                            "clickHandlerArgs": "1",
                            //"createTooltipFunc": hotspot,
                            //"createTooltipArgs": "-- posso passare valori ad una funzione -- "
                        },
                        {
                            "pitch": -14.50,
                            "yaw": -200.95,
                            "cssClass": "prova1",
                            "id": "2",
                            "clickHandlerFunc": showModal, //onclick function
                            "clickHandlerArgs": "2",
                            //"createTooltipFunc": hotspot,
                            //"createTooltipArgs": "-- posso passare valori ad una funzione -- "
                        }
                    ]
                },


                "Hall1": {
                    "title": "Hall1",
                    "yaw": 0,

                     "minYaw": -179,
                     "maxYaw": 179,
                    "minPitch": 0,
                    "maxPitch": 0,

                    "haov": 360,
                    "vaov": 86,

                    "hfov": 64,
                    // "vfov": 100, ???
                     "minHfov": 50,
                     "maxHfov": 100,


                    "type": "equirectangular",
                    "panorama": "img/rooms/hall1.jpg",
                    "hotSpots": [
                        {
                            "pitch": 7.2,
                            "yaw": -164.52,
                            "type": "scene",
                            "text": "AulaMagna",
                            "sceneId": "AulaMagna",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        { 
                            "pitch": 13.38,
                            "yaw": -119.1,
                            "type": "info",
                            "text": "Lorem ipsum"
                        }
                    ]
                },

                "AulaMagna": {
                    "title": "Aula Magna",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/AulaMagna.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "corte1",
                            "sceneId": "Corte1",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },

                 "Corte1": {
                    "title": "Corte1",
                    "hfov": 110,
                    "yaw": 0,
                    "vaov": 95,
                    "haov": 250,    
                    "type": "equirectangular",
                    "panorama": "img/rooms/corte1.jpg",
                    "hotSpots": [
                        {
                            "pitch": 8.4,
                            "yaw": -33.91,
                            "type": "scene",
                            "text": "Corte2",
                            "sceneId": "Corte2",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": 0,
                            "yaw": 0,
                            "type": "info",
                            "text": "Lorem Ipsum"
                        }
                    ]
                },
                "Corte2": {
                    "title": "Corte2",
                    "hfov": 110,
                    "yaw": 0,
                    "vaov": 95,
                    "haov": 250,
                    "type": "equirectangular",
                    "panorama": "img/rooms/corte2.jpg",
                    "hotSpots": [
                        { 
                            "pitch": 2.55,
                            "yaw": -43.96,
                            "type": "scene",
                            "text": "Aula1",
                            "sceneId": "Aula1",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": 0,
                            "yaw": 0,
                            "type": "info",
                            "text": "Lorem Ipsum"
                        }
                    ]
                },
                "Aula1": {
                    "title": "Aula1",
                    "hfov": 110,
                    "yaw": 0,
                    "vaov": 80,
                    "haov": 250,
                    "type": "equirectangular",
                    "panorama": "img/rooms/aula1.jpg",
                    "hotSpots": [
                        { 
                            "pitch":  15.79,
                            "yaw": 44.70,
                            "type": "scene",
                            "text": "Aula2",
                            "sceneId": "Aula2",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch":0,
                            "yaw": 0,
                            "type": "info",
                            "text": "Lorem ipsum"
                        }
                    ]
                },
                "Aula2": {
                    "title": "Aula2",
                    "haov": 120,
                    "vaov": 67,
                    "yaw": 0,
                    "type": "equirectangular",
                    "panorama": "img/rooms/aula2.jpg",
                    "hotSpots": [
                        {
                            "pitch":  -3.96,
                            "yaw": 48.83,
                            "type": "scene",
                            "text": "Corridoio1",
                            "sceneId": "Corridoio1",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        { 
                            "pitch": -0.39,
                            "yaw": -11.12,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Corridoio1": {
                    "title": "corridoio1",
                    "hfov": 110,
                    "yaw": 44.575,
                    "haov": 160,
                    "vaov": 120,
                    "type": "equirectangular",
                    "panorama": "img/rooms/Corridoio1.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Balcone",
                            "sceneId": "Balcone",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Balcone": {
                    "title": "Balcone",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/balcone.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Bar",
                            "sceneId": "Bar",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                    "Bar": {
                    "title": "Bar",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/bar.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Corridoio2",
                            "sceneId": "Corridoio2",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Corridoio2": {
                    "title": "Corridoio2",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/corridoio2.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Biblioteca",
                            "sceneId": "Biblioteca",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Biblioteca": {
                    "title": "Biblioteca",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/biblioteca.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Hall2",
                            "sceneId": "Hall2",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Hall2": {
                    "title": "Hall2",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/hall2.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Hall3",
                            "sceneId": "Hall3",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
               

                "Hall3": {
                    "title": "Hall3",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/hall3.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Aula4",
                            "sceneId": "Aula4",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Aula4": {
                    "title": "Aula4",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/aula4.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Lab1",
                            "sceneId": "Lab1",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Lab1": {
                    "title": "Lab1",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/lab1.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "Lab4",
                            "sceneId": "Lab4",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                },
                "Lab4": {
                    "title": "Lab4",
                    "hfov": 110,
                    "yaw": 5,
                    "type": "equirectangular",
                    "panorama": "img/rooms/lab4.jpg",
                    "hotSpots": [
                        {
                            "pitch": -12,
                            "yaw": -141.57,
                            "type": "scene",
                            "text": "AulaMagna",
                            "sceneId": "AulaMagna",
                            "targetYaw": 107,
                            "targetPitch": 4
                        },
                        {
                            "pitch": -1.40,
                            "yaw": -170.94,
                            "type": "info",
                            "text": "Questa è una bella lavagna"
                        }
                    ]
                }
            }
        });



        $(document).ready(function () {
            $('[data-toggle="popover"]').popover();
        });







        //Gestione punti
        var numeroRitrovamenti = 0;

        function showModal(args, i) {
            var tempI = i;
            $("#myModal").modal();
            addPoint(tempI);
        }



        function addPoint(i) {

            numeroRitrovamenti++;
            document.getElementById("ciao").setAttribute('data-content', "Attualmente hai trovato " + numeroRitrovamenti + "/17 SDGs!");

            var bool = viewer.removeHotSpot(i,viewer.getScene());
            
            viewer.addHotSpot(
                {                  
                            "pitch": -0.6,
                            "yaw": 37.1,
                            "type": "scene",
                            "text": "Hall1",
                            "sceneId": "Hall1",
                            "targetYaw": -23,
                            "targetPitch": 2
                });

            // if (numeroRitrovamenti == 2) {
            //     alert("Hai trovato tutti gli SDG!")
            // }

        }





        //****************************************************************THREE.JS*************************************************************


        import { GLTFLoader } from './node_modules/three/examples/jsm/loaders/GLTFLoader.js';
        import { OrbitControls } from './node_modules/three/examples/jsm/controls/OrbitControls.js';

        let model;
        let wave;
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 500);
        const loader = new GLTFLoader();
        var mixer;
        let fileAnimations;
        let clock = new THREE.Clock();
        var renderer = new THREE.WebGLRenderer({alpha: true });

        renderer.setSize(200, 200);

        

        loader.load('3Dimg/2_goal.glb', function (gltf) {
            model = gltf.scene;
            model.rotation.x += 0.5;
            fileAnimations = gltf.animations;
            mixer = new THREE.AnimationMixer(model);
            console.log(gltf.animations);
            mixer.clipAction(fileAnimations[0]).play();
            mixer.clipAction(fileAnimations[1]).play();
            mixer.clipAction(fileAnimations[2]).play();
            scene.add(gltf.scene);

        }, undefined, function (error) {

            console.error(error);

        });


        camera.position.z = 3.5;
        camera.position.y = 0.2;
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.1);
        hemiLight.position.set(10, 20, 10);
        scene.add(hemiLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(- 3, 10, - 10);
        scene.add(dirLight);
        const controls = new OrbitControls(camera, renderer.domElement);





        
        controls.update();

        function animate() {

            requestAnimationFrame(animate);
            if (mixer) {
                model.rotation.y += 0.01;
                mixer.update(clock.getDelta());
            }

            controls.update();
            renderer.render(scene, camera);

        }





        animate();



         


        function sceneChangeListener() {
            console.log("Scene changed");
            console.log("Scene id: " + viewer.getScene());

        };

        function sceneLoadListener() {
            // console.log("Load done");
            var hotspotList = document.getElementsByClassName("prova1");
            if(viewer.getScene() == "IngressoCampus"){
                console.log(hotspotList);    
                hotspotList[0].appendChild(renderer.domElement);
                }
            };

        viewer.on('scenechange', sceneChangeListener);
        viewer.on('load', sceneLoadListener);


    </script>

</body>

</html>